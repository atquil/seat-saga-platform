databaseChangeLog:
  - changeSet:
      id: 01-seed-data
      author: atquil
      context: local, dev, prod
      changes:
        - sql:
            sql: |
              -- Seed Partner
              INSERT INTO seat_saga_partner (name, contact_email, api_key) 
              VALUES ('PVR Cinemas', 'contact@pvr.com', 'pk_test_12345');

              -- Seed Theatre
              INSERT INTO theatre (partner_id, name, city, address)
              VALUES ((SELECT id FROM seat_saga_partner LIMIT 1), 'PVR Koramangala', 'Bengaluru', 'Forum Mall, Koramangala');

              -- Seed Screen
              INSERT INTO screen (theatre_id, name, total_seats)
              VALUES ((SELECT id FROM theatre LIMIT 1), 'Screen 1', 10);

              -- Seed Seats (Rows A and B, 5 seats each)
              INSERT INTO seat (screen_id, row_number, seat_number, seat_type)
              SELECT (SELECT id FROM screen LIMIT 1), 'A', s, 'REGULAR' FROM generate_series(1, 5) AS s;
              
              INSERT INTO seat (screen_id, row_number, seat_number, seat_type)
              SELECT (SELECT id FROM screen LIMIT 1), 'B', s, 'PREMIUM' FROM generate_series(1, 5) AS s;

              -- Seed Movie
              INSERT INTO movie (title, duration_minutes, genre)
              VALUES ('Inception', 148, 'Sci-Fi');

              -- Seed Show (Tomorrow at 6 PM)
              INSERT INTO show (movie_id, screen_id, start_time, end_time, base_price)
              VALUES (
                (SELECT id FROM movie LIMIT 1), 
                (SELECT id FROM screen LIMIT 1), 
                NOW() + INTERVAL '1 day', 
                NOW() + INTERVAL '1 day' + INTERVAL '148 minutes', 
                250.00
              );

              -- Seed ShowSeats Inventory (Cartesian product of seats + show)
              INSERT INTO show_seat (show_id, seat_id, status, price)
              SELECT 
                sh.id, 
                s.id, 
                'AVAILABLE',
                CASE WHEN s.seat_type = 'PREMIUM' THEN sh.base_price + 100 ELSE sh.base_price END
              FROM show sh
              CROSS JOIN seat s
              WHERE sh.screen_id = s.screen_id;